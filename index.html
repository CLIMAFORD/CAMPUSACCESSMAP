<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="Smart Campus Access Map - Report and track accessibility issues in real-time">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/leaflet-measure.css">
    <link rel="stylesheet" href="css/leaflet.photon.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/smart-campus.css">
    
    <title>Smart Campus Access Map</title>
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="navbar navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-university"></i> Smart Campus Access Map
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" 
                    aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <!-- Main Layout Container -->
    <div class="main-container">
        <!-- Map Container -->
        <div id="map" class="map-container"></div>

        <!-- Right Sidebar -->
        <div class="sidebar-right">
            <!-- Tabs Navigation -->
            <ul class="nav nav-tabs sidebar-tabs" id="sidebarTabs" role="tablist">
                <li class="nav-item" role="presentation" title="Map Layers">
                    <button class="nav-link active" id="layers-tab" data-bs-toggle="tab" data-bs-target="#layers" 
                            type="button" role="tab" aria-selected="true">
                        <i class="fas fa-layer-group"></i>
                    </button>
                </li>
                <li class="nav-item" role="presentation" title="Report Issue">
                    <button class="nav-link" id="report-tab" data-bs-toggle="tab" data-bs-target="#report" 
                            type="button" role="tab" aria-selected="false">
                        <i class="fas fa-flag"></i>
                    </button>
                </li>
                <li class="nav-item" role="presentation" title="Active Issues">
                    <button class="nav-link" id="issues-tab" data-bs-toggle="tab" data-bs-target="#issues" 
                            type="button" role="tab" aria-selected="false">
                        <i class="fas fa-list"></i>
                        <span class="badge bg-danger" id="issueCount">0</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation" title="Analytics">
                    <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" 
                            type="button" role="tab" aria-selected="false">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                </li>
                <li class="nav-item" role="presentation" title="Directions">
                    <button class="nav-link" id="directions-tab" data-bs-toggle="tab" data-bs-target="#directions" 
                            type="button" role="tab" aria-selected="false">
                        <i class="fas fa-directions"></i>
                    </button>
                </li>
                <li class="nav-item" role="presentation" title="Traffic">
                    <button class="nav-link" id="traffic-tab" data-bs-toggle="tab" data-bs-target="#traffic" 
                            type="button" role="tab" aria-selected="false">
                        <i class="fas fa-users"></i>
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content sidebar-content">
                <!-- Layers Tab -->
                <div class="tab-pane fade show active" id="layers" role="tabpanel" aria-labelledby="layers-tab">
                    <div class="p-3">
\|                        <div id="layerControl" class="layer-tree"></div>
                    </div>
                </div>

                <!-- Report Issue Tab -->
                <div class="tab-pane fade" id="report" role="tabpanel" aria-labelledby="report-tab">
                    <div class="p-3">
                        <h6 class="mb-3"><i class="fas fa-flag"></i> Report Accessibility Issue</h6>
                        <form id="reportForm" class="report-form">
                            <div class="mb-3">
                                <label class="form-label">Issue Type <span class="text-danger">*</span></label>
                                <select class="form-select form-select-sm" id="issueType" required>
                                    <option value="">Select Type...</option>
                                    <option value="blocked-ramp">Blocked Ramp</option>
                                    <option value="elevator-broken">Broken Elevator</option>
                                    <option value="door-broken">Broken Door</option>
                                    <option value="parking">Parking Issue</option>
                                    <option value="path-damaged">Damaged Pathway</option>
                                    <option value="signage">Missing Signage</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Location <span class="text-danger">*</span></label>
                                <input type="text" class="form-control form-control-sm" id="issueLocation" 
                                       placeholder="Building or area" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Description <span class="text-danger">*</span></label>
                                <textarea class="form-control form-control-sm" id="issueDescription" 
                                          rows="3" placeholder="Describe the issue..." required></textarea>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Severity</label>
                                <div class="btn-group btn-group-sm w-100" role="group">
                                    <input type="radio" class="btn-check" name="severity" id="severity-low" value="low" checked>
                                    <label class="btn btn-outline-success" for="severity-low">Low</label>
                                    
                                    <input type="radio" class="btn-check" name="severity" id="severity-medium" value="medium">
                                    <label class="btn btn-outline-warning" for="severity-medium">Medium</label>
                                    
                                    <input type="radio" class="btn-check" name="severity" id="severity-high" value="high">
                                    <label class="btn btn-outline-danger" for="severity-high">High</label>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="useLocation" checked>
                                    <label class="form-check-label" for="useLocation">
                                        Use current location
                                    </label>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-sm w-100">
                                <i class="fas fa-paper-plane"></i> Submit Report
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Active Issues Tab -->
                <div class="tab-pane fade" id="issues" role="tabpanel" aria-labelledby="issues-tab">
                    <div class="p-3">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0"><i class="fas fa-list"></i> Active Issues</h6>
                            <button class="btn btn-sm btn-outline-secondary" id="refreshIssues" title="Refresh">
                                <i class="fas fa-sync"></i>
                            </button>
                        </div>
                        <div id="issuesList" class="issues-list"></div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div class="tab-pane fade" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
                    <div class="p-3">
                        <h6 class="mb-3"><i class="fas fa-chart-bar"></i> Access Analytics</h6>
                        <div class="analytics-container">
                            <div class="stat-card">
                                <div class="stat-value" id="statTotalReports">0</div>
                                <div class="stat-label">Total Reports</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statResolved">0</div>
                                <div class="stat-label">Resolved</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statPending">0</div>
                                <div class="stat-label">Pending</div>
                            </div>
                        </div>
                        <!-- Analytics Visualization Section (User Visible) -->
                        <div id="analyticsCharts" class="mt-4">
                            <div class="chart-section">
                                <h6 class="mb-2">Issues by Type</h6>
                                <div id="typeChart" class="simple-chart"></div>
                            </div>
                            <div class="chart-section mt-3">
                                <h6 class="mb-2">Issues by Severity</h6>
                                <div id="severityChart" class="simple-chart"></div>
                            </div>
                            <div class="chart-section mt-3">
                                <h6 class="mb-2">Issues by Status</h6>
                                <div id="statusChart" class="simple-chart"></div>
                            </div>
                        </div>

                        <!-- Data Export Restricted Notice -->
                        <div class="mt-4 p-3 bg-warning bg-opacity-10 border border-warning rounded">
                            <h6 class="mb-2 text-warning"><i class="fas fa-lock"></i> Data Export</h6>
                            <small class="text-muted d-block">Detailed data exports are only available to administrators through the backend portal. Users can view all analytics visualizations and charts on this page.</small>
                        </div>
                    </div>
                </div>

                <!-- Directions Tab -->
                <div class="tab-pane fade" id="directions" role="tabpanel" aria-labelledby="directions-tab">
                    <div class="p-3">
                        <h6 class="mb-3"><i class="fas fa-directions"></i> Directions & Routing</h6>
                        
                        <!-- Location Tracking Toggle -->
                        <div class="mb-3">
                            <label class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="enableLocationTracking">
                                <span class="form-check-label">Enable Location Tracking</span>
                            </label>
                            <small class="text-muted d-block mt-1">Share your location to help analyze campus traffic patterns</small>
                        </div>

                        <!-- Directions Input -->
                        <div class="mb-3">
                            <label class="form-label form-label-sm">From (Starting Point)</label>
                            <div class="input-group input-group-sm mb-2">
                                <input type="text" class="form-control" id="fromLocation" placeholder="Search campus location or enter coordinates" autocomplete="off">
                                <button class="btn btn-outline-secondary btn-sm" type="button" id="btnMyLocation" title="Use my current location">
                                    <i class="fas fa-location-arrow"></i>
                                </button>
                            </div>
                            <div id="fromLocationDropdown" class="list-group list-group-sm mb-2" style="display: none; position: absolute; width: 100%; z-index: 1000;"></div>
                            <small class="text-muted d-block">Type campus location name or GPS coordinates (lat, lon)</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label form-label-sm">To (Destination)</label>
                            <div class="input-group input-group-sm mb-2">
                                <input type="text" class="form-control" id="toLocation" placeholder="Search campus location or enter coordinates" autocomplete="off">
                                <button class="btn btn-outline-secondary btn-sm" type="button" id="btnBrowseDestination" title="Browse locations">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                            <div id="toLocationDropdown" class="list-group list-group-sm mb-2" style="display: none; position: absolute; width: 100%; z-index: 1000;"></div>
                            <small class="text-muted d-block">Select a campus building or location</small>
                        </div>

                        <!-- Transport Mode Selection -->
                        <div class="mb-3">
                            <label class="form-label form-label-sm">Mode of Transport</label>
                            <div class="btn-group btn-group-sm w-100" role="group">
                                <input type="radio" class="btn-check" name="transportMode" id="mode-walking" value="walking" checked>
                                <label class="btn btn-outline-secondary" for="mode-walking">
                                    <i class="fas fa-walking"></i> Walking
                                </label>
                                
                                <input type="radio" class="btn-check" name="transportMode" id="mode-driving" value="driving">
                                <label class="btn btn-outline-secondary" for="mode-driving">
                                    <i class="fas fa-car"></i> Driving
                                </label>
                                
                                <input type="radio" class="btn-check" name="transportMode" id="mode-bicycling" value="bicycling">
                                <label class="btn btn-outline-secondary" for="mode-bicycling">
                                    <i class="fas fa-bicycle"></i> Cycling
                                </label>
                                
                                <input type="radio" class="btn-check" name="transportMode" id="mode-transit" value="transit">
                                <label class="btn btn-outline-secondary" for="mode-transit">
                                    <i class="fas fa-bus"></i> Transit
                                </label>
                            </div>
                            <small class="text-muted d-block mt-2">Select your preferred transportation mode</small>
                        </div>

                        <!-- Route Options -->
                        <div class="mb-3">
                            <label class="form-label form-label-sm">Route Options</label>
                            <div class="form-check form-check-sm">
                                <input class="form-check-input" type="checkbox" id="wheelchairAccessible">
                                <label class="form-check-label" for="wheelchairAccessible">
                                    Wheelchair Accessible
                                </label>
                            </div>
                            <div class="form-check form-check-sm">
                                <input class="form-check-input" type="checkbox" id="avoidCrowded">
                                <label class="form-check-label" for="avoidCrowded">
                                    Avoid Crowded Areas
                                </label>
                            </div>
                        </div>

                        <!-- Get Directions Button -->
                        <button class="btn btn-primary btn-sm w-100 mb-3" id="btnGetDirections">
                            <i class="fas fa-search"></i> Get Directions
                        </button>

                        <!-- Route Information -->
                        <div id="routeInfo" class="mt-3"></div>
                    </div>
                </div>

                <!-- Traffic Analysis Tab -->
                <div class="tab-pane fade" id="traffic" role="tabpanel" aria-labelledby="traffic-tab">
                    <div class="p-3">
                        <h6 class="mb-3"><i class="fas fa-users"></i> Campus Traffic & Crowds</h6>
                        
                        <!-- Visualization Toggles -->
                        <div class="mb-3">
                            <label class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="toggleHeatmap" checked>
                                <span class="form-check-label">Show Heatmap</span>
                            </label>
                        </div>
                        <div class="mb-3">
                            <label class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="toggleCrowdDensity" checked>
                                <span class="form-check-label">Show Crowd Density</span>
                            </label>
                        </div>

                        <!-- Traffic Statistics -->
                        <div id="trafficStats" class="mt-3">
                            <div class="alert alert-info">
                                <small>Loading traffic data...</small>
                            </div>
                        </div>

                        <!-- Refresh Button -->
                        <button class="btn btn-outline-primary btn-sm w-100 mt-3" id="btnRefreshTraffic">
                            <i class="fas fa-sync"></i> Refresh Traffic Data
                        </button>

                        <!-- Traffic Legend -->
                        <div class="mt-4 p-2 bg-light rounded">
                            <h6 class="mb-2">Traffic Levels</h6>
                            <div class="d-flex align-items-center mb-2">
                                <div class="badge" style="background-color: #00ff00; width: 20px; height: 20px; margin-right: 8px;"></div>
                                <small>Low Traffic</small>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <div class="badge" style="background-color: #ffff00; width: 20px; height: 20px; margin-right: 8px;"></div>
                                <small>Moderate Traffic</small>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <div class="badge" style="background-color: #ff9500; width: 20px; height: 20px; margin-right: 8px;"></div>
                                <small>Crowded</small>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="badge" style="background-color: #ff0000; width: 20px; height: 20px; margin-right: 8px;"></div>
                                <small>Very Crowded</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button for Mobile -->
        <button class="fab fab-primary" id="fabReport" title="Report Issue">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Offcanvas Sidebar for Mobile -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="sidebar" aria-labelledby="sidebarLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="sidebarLabel">Menu</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="switchTab('layers-tab')">
                        <i class="fas fa-layer-group"></i> Map Layers
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="switchTab('report-tab')">
                        <i class="fas fa-flag"></i> Report Issue
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="switchTab('issues-tab')">
                        <i class="fas fa-list"></i> Active Issues
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="switchTab('analytics-tab')">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="switchTab('directions-tab')">
                        <i class="fas fa-directions"></i> Directions
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="switchTab('traffic-tab')">
                        <i class="fas fa-users"></i> Traffic
                    </a>
                </li>
                <hr class="my-2">
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="exportData()">
                        <i class="fas fa-download"></i> Export Data
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="#" class="text-decoration-none" data-bs-dismiss="offcanvas" onclick="clearAllData()">
                        <i class="fas fa-trash"></i> Clear Data
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" id="toastContainer"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JS -->
    <script src="js/leaflet.js"></script>
    <!-- Leaflet Heatmap Library - MUST load after Leaflet.js -->
    <script src="https://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/leaflet.photon.js"></script>
    <script src="js/leaflet-measure.js"></script>
    
    <!-- QGIS Data Layers -->
    <script src="data/MasenoTown_1.js"></script>
    <script src="data/Forest_2.js"></script>
    <script src="data/Maseno_University_3.js"></script>
    <script src="data/Forests_4.js"></script>
    <script src="data/Fields_5.js"></script>
    <script src="data/Niles_6.js"></script>
    <script src="data/College_Campus_7.js"></script>
    <script src="data/Siriba_8.js"></script>
    <script src="data/Niles_bldngs_9.js"></script>
    <script src="data/Siriba_bldngs_10.js"></script>
    <script src="data/CC_bldngs_11.js"></script>
    <script src="data/MasenoRoads_12.js"></script>
    
    <!-- Firebase SDK (Compat version for global firebase object) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-messaging-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics-compat.js"></script>
    
    <!-- Firebase Configuration & Custom Modules -->
    <script src="firebase-config.js"></script>
    
    <!-- Initialize Firebase (must run after SDK loads) -->
    <script>
        // Wait for Firebase SDK to be ready
        window.addEventListener('load', function() {
            if (typeof firebase !== 'undefined' && FIREBASE_ENABLED) {
                try {
                    firebase.initializeApp(FIREBASE_CONFIG);
                    console.log('✅ Firebase initialized successfully');
                } catch (error) {
                    // Firebase already initialized or init error
                    if (error.code !== 'app/duplicate-app') {
                        console.warn('Firebase initialization info:', error.message);
                    }
                }
            }
        });
    </script>
    
    <script src="js/firebase-export.js"></script>
    <script src="js/firebase-sync.js"></script>
    <script src="js/firebase-notifications.js"></script>
    <script src="js/hybrid-storage.js"></script>
    
    <!-- Custom JS Modules -->
    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/smart-campus-storage.js"></script>
    <script src="js/smart-campus-map.js"></script>
    <script src="js/smart-campus-issues.js"></script>
    <script src="js/smart-campus-notifications.js"></script>
    <script src="js/smart-campus-analytics.js"></script>
    <script src="js/smart-campus-ui.js"></script>
    
    <!-- New Location & Navigation Modules -->
    <script src="js/smart-campus-location-tracking.js"></script>
    <script src="js/google-maps-directions.js"></script>
    <script src="js/smart-campus-directions.js"></script>
    <script src="js/smart-campus-heatmap.js"></script>
    <script src="js/smart-campus-location-ui.js"></script>
    
    <!-- App Initialization -->
    <script src="js/smart-campus-app.js"></script>

    <!-- Original QGIS Map Setup - Preserved -->
    <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: 'rgba(255, 255, 0, 1.00)',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: 'rgba(255, 255, 0, 1.00)',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[-0.014019237932566764,34.58858076035669],[0.003651351954024558,34.61493114399558]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // modify popup if contains media
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.update();
                    }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true;
                    audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true;
                    video.src = src;
                    video.style.width = "400px";
                    video.style.height = "300px";
                    video.style.maxHeight = "60vh";
                    video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    // Aggiorna il popup quando il video carica i metadati
                    video.addEventListener('loadedmetadata', function() {
                        popup.update();
                    });
                    setTimeout(function() {
                        popup.setContent(tempDiv.innerHTML);
                        popup.update();
                    }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }
        var title = new L.Control({'position':'topright'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>MASENO UNIVERSITY INTERACTIVE MAP</h2>';
        };
        title.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_OSMStandard_0');
        map.getPane('pane_OSMStandard_0').style.zIndex = 400;
        var layer_OSMStandard_0 = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OSMStandard_0',
            opacity: 0.9,
            attribution: '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OSMStandard_0;
        map.addLayer(layer_OSMStandard_0);
        function pop_MasenoTown_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_id'] !== null ? autolinker.link(String(feature.properties['full_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_type'] !== null ? autolinker.link(String(feature.properties['osm_type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['place'] !== null ? autolinker.link(String(feature.properties['place']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_MasenoTown_1_0() {
            return {
                pane: 'pane_MasenoTown_1',
                opacity: 1,
                color: 'rgba(200, 60, 56, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(220, 100, 90, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_MasenoTown_1');
        map.getPane('pane_MasenoTown_1').style.zIndex = 401;
        map.getPane('pane_MasenoTown_1').style['mix-blend-mode'] = 'normal';
        var layer_MasenoTown_1 = new L.geoJson(json_MasenoTown_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_MasenoTown_1',
            layerName: 'layer_MasenoTown_1',
            pane: 'pane_MasenoTown_1',
            onEachFeature: pop_MasenoTown_1,
            style: style_MasenoTown_1_0,
        });
        bounds_group.addLayer(layer_MasenoTown_1);
        map.addLayer(layer_MasenoTown_1);
        function pop_Forest_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_id'] !== null ? autolinker.link(String(feature.properties['full_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_type'] !== null ? autolinker.link(String(feature.properties['osm_type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['landuse'] !== null ? autolinker.link(String(feature.properties['landuse']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Forest_2_0() {
            return {
                pane: 'pane_Forest_2',
                opacity: 1,
                color: 'rgba(76, 110, 56, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.75,
                fillColor: 'rgba(110, 160, 75, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Forest_2');
        map.getPane('pane_Forest_2').style.zIndex = 402;
        map.getPane('pane_Forest_2').style['mix-blend-mode'] = 'normal';
        var layer_Forest_2 = new L.geoJson(json_Forest_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Forest_2',
            layerName: 'layer_Forest_2',
            pane: 'pane_Forest_2',
            onEachFeature: pop_Forest_2,
            style: style_Forest_2_0,
        });
        bounds_group.addLayer(layer_Forest_2);
        map.addLayer(layer_Forest_2);
        function pop_Maseno_University_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NAME'] !== null ? autolinker.link(String(feature.properties['NAME']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Maseno_University_3_0() {
            return {
                pane: 'pane_Maseno_University_3',
                opacity: 1,
                color: 'rgba(88, 130, 50, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(150, 190, 90, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Maseno_University_3');
        map.getPane('pane_Maseno_University_3').style.zIndex = 403;
        map.getPane('pane_Maseno_University_3').style['mix-blend-mode'] = 'normal';
        var layer_Maseno_University_3 = new L.geoJson(json_Maseno_University_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Maseno_University_3',
            layerName: 'layer_Maseno_University_3',
            pane: 'pane_Maseno_University_3',
            onEachFeature: pop_Maseno_University_3,
            style: style_Maseno_University_3_0,
        });
        bounds_group.addLayer(layer_Maseno_University_3);
        map.addLayer(layer_Maseno_University_3);
        function pop_Forests_4(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Forests_4_0() {
            return {
                pane: 'pane_Forests_4',
                opacity: 1,
                color: 'rgba(200, 120, 20, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.75,
                fillColor: 'rgba(240, 160, 40, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Forests_4');
        map.getPane('pane_Forests_4').style.zIndex = 404;
        map.getPane('pane_Forests_4').style['mix-blend-mode'] = 'normal';
        var layer_Forests_4 = new L.geoJson(json_Forests_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Forests_4',
            layerName: 'layer_Forests_4',
            pane: 'pane_Forests_4',
            onEachFeature: pop_Forests_4,
            style: style_Forests_4_0,
        });
        bounds_group.addLayer(layer_Forests_4);
        map.addLayer(layer_Forests_4);
        function pop_Fields_5(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Fields_5_0() {
            return {
                pane: 'pane_Fields_5',
                opacity: 1,
                color: 'rgba(180, 100, 120, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.75,
                fillColor: 'rgba(220, 140, 160, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Fields_5');
        map.getPane('pane_Fields_5').style.zIndex = 405;
        map.getPane('pane_Fields_5').style['mix-blend-mode'] = 'normal';
        var layer_Fields_5 = new L.geoJson(json_Fields_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Fields_5',
            layerName: 'layer_Fields_5',
            pane: 'pane_Fields_5',
            onEachFeature: pop_Fields_5,
            style: style_Fields_5_0,
        });
        bounds_group.addLayer(layer_Fields_5);
        map.addLayer(layer_Fields_5);
        function pop_Niles_6(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Niles_6_0() {
            return {
                pane: 'pane_Niles_6',
                opacity: 1,
                color: 'rgba(160, 50, 100, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(210, 90, 140, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Niles_6');
        map.getPane('pane_Niles_6').style.zIndex = 406;
        map.getPane('pane_Niles_6').style['mix-blend-mode'] = 'normal';
        var layer_Niles_6 = new L.geoJson(json_Niles_6, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Niles_6',
            layerName: 'layer_Niles_6',
            pane: 'pane_Niles_6',
            onEachFeature: pop_Niles_6,
            style: style_Niles_6_0,
        });
        bounds_group.addLayer(layer_Niles_6);
        map.addLayer(layer_Niles_6);
        function pop_College_Campus_7(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_College_Campus_7_0() {
            return {
                pane: 'pane_College_Campus_7',
                opacity: 1,
                color: 'rgba(160, 140, 40, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.75,
                fillColor: 'rgba(220, 190, 70, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_College_Campus_7');
        map.getPane('pane_College_Campus_7').style.zIndex = 407;
        map.getPane('pane_College_Campus_7').style['mix-blend-mode'] = 'normal';
        var layer_College_Campus_7 = new L.geoJson(json_College_Campus_7, {
            attribution: '',
            interactive: true,
            dataVar: 'json_College_Campus_7',
            layerName: 'layer_College_Campus_7',
            pane: 'pane_College_Campus_7',
            onEachFeature: pop_College_Campus_7,
            style: style_College_Campus_7_0,
        });
        bounds_group.addLayer(layer_College_Campus_7);
        map.addLayer(layer_College_Campus_7);
        function pop_Siriba_8(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NAME'] !== null ? autolinker.link(String(feature.properties['NAME']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Siriba_8_0() {
            return {
                pane: 'pane_Siriba_8',
                opacity: 1,
                color: 'rgba(100, 50, 120, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(160, 100, 170, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Siriba_8');
        map.getPane('pane_Siriba_8').style.zIndex = 408;
        map.getPane('pane_Siriba_8').style['mix-blend-mode'] = 'normal';
        var layer_Siriba_8 = new L.geoJson(json_Siriba_8, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Siriba_8',
            layerName: 'layer_Siriba_8',
            pane: 'pane_Siriba_8',
            onEachFeature: pop_Siriba_8,
            style: style_Siriba_8_0,
        });
        bounds_group.addLayer(layer_Siriba_8);
        map.addLayer(layer_Siriba_8);
        function pop_Niles_bldngs_9(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_id'] !== null ? autolinker.link(String(feature.properties['full_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_type'] !== null ? autolinker.link(String(feature.properties['osm_type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['building'] !== null ? autolinker.link(String(feature.properties['building']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loading_dock'] !== null ? autolinker.link(String(feature.properties['loading_dock']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand:wikipedia'] !== null ? autolinker.link(String(feature.properties['brand:wikipedia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand:wikidata'] !== null ? autolinker.link(String(feature.properties['brand:wikidata']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand'] !== null ? autolinker.link(String(feature.properties['brand']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['craft'] !== null ? autolinker.link(String(feature.properties['craft']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:full'] !== null ? autolinker.link(String(feature.properties['addr:full']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tourism'] !== null ? autolinker.link(String(feature.properties['tourism']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['wheelchair'] !== null ? autolinker.link(String(feature.properties['wheelchair']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['start_date'] !== null ? autolinker.link(String(feature.properties['start_date']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['product'] !== null ? autolinker.link(String(feature.properties['product']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['phone'] !== null ? autolinker.link(String(feature.properties['phone']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['operator'] !== null ? autolinker.link(String(feature.properties['operator']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['operational_status'] !== null ? autolinker.link(String(feature.properties['operational_status']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['certifications'] !== null ? autolinker.link(String(feature.properties['certifications']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:subcounty'] !== null ? autolinker.link(String(feature.properties['addr:subcounty']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:description'] !== null ? autolinker.link(String(feature.properties['addr:description']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:county'] !== null ? autolinker.link(String(feature.properties['addr:county']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:country'] !== null ? autolinker.link(String(feature.properties['addr:country']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['access'] !== null ? autolinker.link(String(feature.properties['access']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['shop'] !== null ? autolinker.link(String(feature.properties['shop']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['payment:paypal'] !== null ? autolinker.link(String(feature.properties['payment:paypal']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['payment:cash'] !== null ? autolinker.link(String(feature.properties['payment:cash']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['opening_hours'] !== null ? autolinker.link(String(feature.properties['opening_hours']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['smoking'] !== null ? autolinker.link(String(feature.properties['smoking']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:street'] !== null ? autolinker.link(String(feature.properties['addr:street']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:city'] !== null ? autolinker.link(String(feature.properties['addr:city']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['amenity'] !== null ? autolinker.link(String(feature.properties['amenity']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loc_name'] !== null ? autolinker.link(String(feature.properties['loc_name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['description'] !== null ? autolinker.link(String(feature.properties['description']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['layer'] !== null ? autolinker.link(String(feature.properties['layer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['height'] !== null ? autolinker.link(String(feature.properties['height']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['building:levels'] !== null ? autolinker.link(String(feature.properties['building:levels']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['type'] !== null ? autolinker.link(String(feature.properties['type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Niles_bldngs_9_0() {
            return {
                pane: 'pane_Niles_bldngs_9',
                opacity: 1,
                color: 'rgba(140, 130, 100, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(200, 185, 150, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Niles_bldngs_9');
        map.getPane('pane_Niles_bldngs_9').style.zIndex = 409;
        map.getPane('pane_Niles_bldngs_9').style['mix-blend-mode'] = 'normal';
        var layer_Niles_bldngs_9 = new L.geoJson(json_Niles_bldngs_9, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Niles_bldngs_9',
            layerName: 'layer_Niles_bldngs_9',
            pane: 'pane_Niles_bldngs_9',
            onEachFeature: pop_Niles_bldngs_9,
            style: style_Niles_bldngs_9_0,
        });
        bounds_group.addLayer(layer_Niles_bldngs_9);
        map.addLayer(layer_Niles_bldngs_9);
        function pop_Siriba_bldngs_10(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_id'] !== null ? autolinker.link(String(feature.properties['full_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_type'] !== null ? autolinker.link(String(feature.properties['osm_type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['building'] !== null ? autolinker.link(String(feature.properties['building']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loading_dock'] !== null ? autolinker.link(String(feature.properties['loading_dock']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand:wikipedia'] !== null ? autolinker.link(String(feature.properties['brand:wikipedia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand:wikidata'] !== null ? autolinker.link(String(feature.properties['brand:wikidata']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand'] !== null ? autolinker.link(String(feature.properties['brand']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['craft'] !== null ? autolinker.link(String(feature.properties['craft']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:full'] !== null ? autolinker.link(String(feature.properties['addr:full']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tourism'] !== null ? autolinker.link(String(feature.properties['tourism']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['wheelchair'] !== null ? autolinker.link(String(feature.properties['wheelchair']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['start_date'] !== null ? autolinker.link(String(feature.properties['start_date']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['product'] !== null ? autolinker.link(String(feature.properties['product']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['phone'] !== null ? autolinker.link(String(feature.properties['phone']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['operator'] !== null ? autolinker.link(String(feature.properties['operator']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['operational_status'] !== null ? autolinker.link(String(feature.properties['operational_status']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['certifications'] !== null ? autolinker.link(String(feature.properties['certifications']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:subcounty'] !== null ? autolinker.link(String(feature.properties['addr:subcounty']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:description'] !== null ? autolinker.link(String(feature.properties['addr:description']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:county'] !== null ? autolinker.link(String(feature.properties['addr:county']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:country'] !== null ? autolinker.link(String(feature.properties['addr:country']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['access'] !== null ? autolinker.link(String(feature.properties['access']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['shop'] !== null ? autolinker.link(String(feature.properties['shop']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['payment:paypal'] !== null ? autolinker.link(String(feature.properties['payment:paypal']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['payment:cash'] !== null ? autolinker.link(String(feature.properties['payment:cash']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['opening_hours'] !== null ? autolinker.link(String(feature.properties['opening_hours']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['smoking'] !== null ? autolinker.link(String(feature.properties['smoking']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:street'] !== null ? autolinker.link(String(feature.properties['addr:street']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:city'] !== null ? autolinker.link(String(feature.properties['addr:city']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['amenity'] !== null ? autolinker.link(String(feature.properties['amenity']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loc_name'] !== null ? autolinker.link(String(feature.properties['loc_name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['description'] !== null ? autolinker.link(String(feature.properties['description']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['layer'] !== null ? autolinker.link(String(feature.properties['layer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['height'] !== null ? autolinker.link(String(feature.properties['height']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['building:levels'] !== null ? autolinker.link(String(feature.properties['building:levels']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['type'] !== null ? autolinker.link(String(feature.properties['type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Siriba_bldngs_10_0() {
            return {
                pane: 'pane_Siriba_bldngs_10',
                opacity: 1,
                color: 'rgba(180, 50, 45, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(220, 80, 70, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_Siriba_bldngs_10');
        map.getPane('pane_Siriba_bldngs_10').style.zIndex = 410;
        map.getPane('pane_Siriba_bldngs_10').style['mix-blend-mode'] = 'normal';
        var layer_Siriba_bldngs_10 = new L.geoJson(json_Siriba_bldngs_10, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Siriba_bldngs_10',
            layerName: 'layer_Siriba_bldngs_10',
            pane: 'pane_Siriba_bldngs_10',
            onEachFeature: pop_Siriba_bldngs_10,
            style: style_Siriba_bldngs_10_0,
        });
        bounds_group.addLayer(layer_Siriba_bldngs_10);
        map.addLayer(layer_Siriba_bldngs_10);
        function pop_CC_bldngs_11(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_id'] !== null ? autolinker.link(String(feature.properties['full_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_type'] !== null ? autolinker.link(String(feature.properties['osm_type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['building'] !== null ? autolinker.link(String(feature.properties['building']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loading_dock'] !== null ? autolinker.link(String(feature.properties['loading_dock']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand:wikipedia'] !== null ? autolinker.link(String(feature.properties['brand:wikipedia']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand:wikidata'] !== null ? autolinker.link(String(feature.properties['brand:wikidata']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['brand'] !== null ? autolinker.link(String(feature.properties['brand']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['craft'] !== null ? autolinker.link(String(feature.properties['craft']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:full'] !== null ? autolinker.link(String(feature.properties['addr:full']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tourism'] !== null ? autolinker.link(String(feature.properties['tourism']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['wheelchair'] !== null ? autolinker.link(String(feature.properties['wheelchair']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['start_date'] !== null ? autolinker.link(String(feature.properties['start_date']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['product'] !== null ? autolinker.link(String(feature.properties['product']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['phone'] !== null ? autolinker.link(String(feature.properties['phone']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['operator'] !== null ? autolinker.link(String(feature.properties['operator']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['operational_status'] !== null ? autolinker.link(String(feature.properties['operational_status']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['certifications'] !== null ? autolinker.link(String(feature.properties['certifications']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:subcounty'] !== null ? autolinker.link(String(feature.properties['addr:subcounty']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:description'] !== null ? autolinker.link(String(feature.properties['addr:description']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:county'] !== null ? autolinker.link(String(feature.properties['addr:county']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:country'] !== null ? autolinker.link(String(feature.properties['addr:country']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['access'] !== null ? autolinker.link(String(feature.properties['access']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['shop'] !== null ? autolinker.link(String(feature.properties['shop']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['payment:paypal'] !== null ? autolinker.link(String(feature.properties['payment:paypal']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['payment:cash'] !== null ? autolinker.link(String(feature.properties['payment:cash']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['opening_hours'] !== null ? autolinker.link(String(feature.properties['opening_hours']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['smoking'] !== null ? autolinker.link(String(feature.properties['smoking']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:street'] !== null ? autolinker.link(String(feature.properties['addr:street']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['addr:city'] !== null ? autolinker.link(String(feature.properties['addr:city']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['amenity'] !== null ? autolinker.link(String(feature.properties['amenity']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loc_name'] !== null ? autolinker.link(String(feature.properties['loc_name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['description'] !== null ? autolinker.link(String(feature.properties['description']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['layer'] !== null ? autolinker.link(String(feature.properties['layer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['height'] !== null ? autolinker.link(String(feature.properties['height']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['building:levels'] !== null ? autolinker.link(String(feature.properties['building:levels']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['type'] !== null ? autolinker.link(String(feature.properties['type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_CC_bldngs_11_0() {
            return {
                pane: 'pane_CC_bldngs_11',
                opacity: 1,
                color: 'rgba(110, 70, 130, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 2.0, 
                fill: true,
                fillOpacity: 0.8,
                fillColor: 'rgba(160, 110, 180, 1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_CC_bldngs_11');
        map.getPane('pane_CC_bldngs_11').style.zIndex = 411;
        map.getPane('pane_CC_bldngs_11').style['mix-blend-mode'] = 'normal';
        var layer_CC_bldngs_11 = new L.geoJson(json_CC_bldngs_11, {
            attribution: '',
            interactive: true,
            dataVar: 'json_CC_bldngs_11',
            layerName: 'layer_CC_bldngs_11',
            pane: 'pane_CC_bldngs_11',
            onEachFeature: pop_CC_bldngs_11,
            style: style_CC_bldngs_11_0,
        });
        bounds_group.addLayer(layer_CC_bldngs_11);
        map.addLayer(layer_CC_bldngs_11);
        function pop_MasenoRoads_12(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_id'] !== null ? autolinker.link(String(feature.properties['full_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_id'] !== null ? autolinker.link(String(feature.properties['osm_id']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['osm_type'] !== null ? autolinker.link(String(feature.properties['osm_type']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['highway'] !== null ? autolinker.link(String(feature.properties['highway']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ford'] !== null ? autolinker.link(String(feature.properties['ford']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['motor_vehicle'] !== null ? autolinker.link(String(feature.properties['motor_vehicle']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['horse'] !== null ? autolinker.link(String(feature.properties['horse']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['bicycle'] !== null ? autolinker.link(String(feature.properties['bicycle']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['construction'] !== null ? autolinker.link(String(feature.properties['construction']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['layer'] !== null ? autolinker.link(String(feature.properties['layer']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['informal'] !== null ? autolinker.link(String(feature.properties['informal']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['junction'] !== null ? autolinker.link(String(feature.properties['junction']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['smoothness'] !== null ? autolinker.link(String(feature.properties['smoothness']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['lanes:forward'] !== null ? autolinker.link(String(feature.properties['lanes:forward']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['destination:ref'] !== null ? autolinker.link(String(feature.properties['destination:ref']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['destination:forward'] !== null ? autolinker.link(String(feature.properties['destination:forward']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['foot'] !== null ? autolinker.link(String(feature.properties['foot']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['loc_name'] !== null ? autolinker.link(String(feature.properties['loc_name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['oneway'] !== null ? autolinker.link(String(feature.properties['oneway']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['embankment'] !== null ? autolinker.link(String(feature.properties['embankment']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['bridge'] !== null ? autolinker.link(String(feature.properties['bridge']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['service'] !== null ? autolinker.link(String(feature.properties['service']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['noname'] !== null ? autolinker.link(String(feature.properties['noname']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['tracktype'] !== null ? autolinker.link(String(feature.properties['tracktype']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['surface'] !== null ? autolinker.link(String(feature.properties['surface']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['motorcycle'] !== null ? autolinker.link(String(feature.properties['motorcycle']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['motorcar'] !== null ? autolinker.link(String(feature.properties['motorcar']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['access'] !== null ? autolinker.link(String(feature.properties['access']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['width'] !== null ? autolinker.link(String(feature.properties['width']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['lanes'] !== null ? autolinker.link(String(feature.properties['lanes']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ref'] !== null ? autolinker.link(String(feature.properties['ref']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? autolinker.link(String(feature.properties['name']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['maxspeed'] !== null ? autolinker.link(String(feature.properties['maxspeed']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['AUTO_ID'] !== null ? autolinker.link(String(feature.properties['AUTO_ID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_MasenoRoads_12_0() {
            return {
                pane: 'pane_MasenoRoads_12',
                opacity: 1,
                color: 'rgba(80, 110, 50, 1.0)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 5.0,
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_MasenoRoads_12');
        map.getPane('pane_MasenoRoads_12').style.zIndex = 412;
        map.getPane('pane_MasenoRoads_12').style['mix-blend-mode'] = 'normal';
        var layer_MasenoRoads_12 = new L.geoJson(json_MasenoRoads_12, {
            attribution: '',
            interactive: true,
            dataVar: 'json_MasenoRoads_12',
            layerName: 'layer_MasenoRoads_12',
            pane: 'pane_MasenoRoads_12',
            onEachFeature: pop_MasenoRoads_12,
            style: style_MasenoRoads_12_0,
        });
        bounds_group.addLayer(layer_MasenoRoads_12);
        map.addLayer(layer_MasenoRoads_12);
        const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "France BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim OSM"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
            // resultsHandler: myHandler,
        }).addTo(map);
        photonControl._container.childNodes[0].style.borderRadius="10px"
        // Create a variable to store the geoJSON data
        var x = null;
        // Create a variable to store the marker
        var marker = null;
        // Add an event listener to the Photon control to create a marker from the returned geoJSON data
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";
        search.style.backgroundColor="rgba(255,255,255,0.5)" 

        // Create the new button element
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";

        // Insert the button at the beginning of the search control
        search.insertBefore(button, search.firstChild);
        last = search.lastChild;
        last.style.display = "none";
        button.addEventListener("click", function (e) {
            if (last.style.display === "none") {
                last.style.display = "block";
            } else {
                last.style.display = "none";
            }
        });
        var overlaysTree = [
            {label: '<img src="legend/MasenoRoads_12.png" /> MasenoRoads', layer: layer_MasenoRoads_12},
            {label: '<img src="legend/CC_bldngs_11.png" /> CC_bldngs', layer: layer_CC_bldngs_11},
            {label: '<img src="legend/Siriba_bldngs_10.png" /> Siriba_bldngs', layer: layer_Siriba_bldngs_10},
            {label: '<img src="legend/Niles_bldngs_9.png" /> Niles_bldngs', layer: layer_Niles_bldngs_9},
            {label: '<img src="legend/Siriba_8.png" /> Siriba', layer: layer_Siriba_8},
            {label: '<img src="legend/College_Campus_7.png" /> College_Campus', layer: layer_College_Campus_7},
            {label: '<img src="legend/Niles_6.png" /> Niles', layer: layer_Niles_6},
            {label: '<img src="legend/Fields_5.png" /> Fields', layer: layer_Fields_5},
            {label: '<img src="legend/Forests_4.png" /> Forests', layer: layer_Forests_4},
            {label: '<img src="legend/Maseno_University_3.png" /> Maseno_University', layer: layer_Maseno_University_3},
            {label: '<img src="legend/Forest_2.png" /> Forest', layer: layer_Forest_2},
            {label: '<img src="legend/MasenoTown_1.png" /> MasenoTown', layer: layer_MasenoTown_1},
            {label: "OSM Standard", layer: layer_OSMStandard_0, radioGroup: 'bm' },]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        
        // Store map and layers globally for access by other modules
        window.mapInstance = map;
        window.mapLayers = {
            roads: layer_MasenoRoads_12,
            ccBuildings: layer_CC_bldngs_11,
            siribaBuildings: layer_Siriba_bldngs_10,
            nilesBuildings: layer_Niles_bldngs_9,
            siriba: layer_Siriba_8,
            collegeCampus: layer_College_Campus_7,
            niles: layer_Niles_6,
            fields: layer_Fields_5,
            forests: layer_Forests_4,
            masenoUniversity: layer_Maseno_University_3,
            forest: layer_Forest_2,
            masenoTown: layer_MasenoTown_1,
            osm: layer_OSMStandard_0
        };
    </script>
</body>
</html>
